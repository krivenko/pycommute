.. _examples:

Usage examples
==============

Kanamori interaction Hamiltonian: Basic usage of expressions
------------------------------------------------------------

The Kanamori multiorbital Hamiltonian describes Coulomb repulsion of
:math:`t_{2g}` electronic states as relevant to a transition-metal ion
in a cubic crystal field with an octahedral environment [GdMM2013]_.
In its rotationally invariant form, the Hamiltonian reads

.. math::

  \begin{multline}
  \hat H_K = U \sum_{m} n_{m\uparrow} n_{m\downarrow} +
             (U-2J)\sum_{m\neq m'} n_{m\uparrow} n_{m'\downarrow} +\\+
             (U-3J)\sum_{m<m',\sigma} n_{m\sigma} n_{m'\sigma}
             -J\sum_{m\neq m'} c^\dagger_{m\uparrow} c_{m\downarrow}
                               c^\dagger_{m'\uparrow} c_{m'\uparrow}
             +J\sum_{m\neq m'} c^\dagger_{m\uparrow} c^\dagger_{m\downarrow}
                               c_{m'\downarrow} c_{m'\uparrow}.
  \end{multline}

The orbital indices :math:`m`, :math:`m'` run over the :math:`t_{2g}` triplet
:math:`p_x, p_y, p_z`. :math:`U` and :math:`J` are Coulomb integrals
(independent parameters of the model). The rotationally invariant Hamiltonian
can be expressed in terms of a few integrals of motion,

.. math::

  \hat H_{t_{2g}} = (U-3J)\frac{\hat N (\hat N-1)}{2}
                  - 2J\mathbf{S}^2 - \frac{J}{2}\mathbf{L}^2
                  + \frac{5}{2}J \hat N,

where :math:`\hat N` is the total number of electrons on the shell,

.. math::

  \hat N = \sum_{m\sigma} n_{m\sigma},

:math:`\mathbf{S}` is the total spin vector,

.. math::

  \mathbf{S} = \frac{1}{2} \sum_m \sum_{\sigma\sigma'}
    c^\dagger_{m\sigma} \boldsymbol{\tau}_{\sigma\sigma'} c_{m\sigma'},

and :math:`\mathbf{L}` is the total orbital isospin,

.. math::

  L_m = i \sum_{mm'} \sum_{\sigma} \epsilon_{mm'm''}
    c^\dagger_{m'\sigma} c_{m''\sigma}.

The following script verifies that :math:`\hat H_K = \hat H_{t_{2g}}` indeed.

.. literalinclude:: examples/kanamori.py
  :language: py
  :lines: 11-
  :linenos:

Holstein model
--------------

This example shows how to construct Hamiltonian of the
`Holstein model <https://arxiv.org/abs/cond-mat/9812252>`_ on a
square lattice and to check that the total number of electrons is a conserved
quantity of the model.

The Hamiltonian considered here is a sum of three terms.

* An electronic tight-binding model on a square lattice with only
  nearest-neighbour hopping allowed,

  .. math::

    \hat H_\text{e} = -t \sum_\sigma \sum_{\langle i,j\rangle}
                      c^\dagger_{i,\sigma} c_{j,\sigma}.

* A harmonic oscillator at each lattice site (a localized phonon),

  .. math::

    \hat H_\text{ph} = \omega_0 \sum_i a^\dagger_i a_i.

* A coupling between the electrons and the phonons.

  .. math::

    \hat H_\text{e-ph} = g \sum_\sigma \sum_i n_{i,\sigma}(a^\dagger_i + a_i).

Instead of writing the sums over lattice sites explicitly, we call library
functions :func:`tight_binding() <pycommute.models.tight_binding>`,
:func:`dispersion() <pycommute.models.dispersion>` and
:func:`holstein_int() <pycommute.models.holstein_int>`.
We also make use of the `NetworkX <https://networkx.org/>`_ package
to easily generate the adjacency matrix of the periodic square lattice.

.. literalinclude:: examples/holstein.py
  :language: python
  :lines: 11-
  :linenos:

Spin-1/2 Heisenberg chain
-------------------------

The spin-1/2 Heisenberg chain is a textbook example of an integrable quantum
system. Its Hamiltonian

.. math::

  \hat H = g \sum_i \mathbf{S}_i \cdot \mathbf{S}_{i+1}

conserves three projections of the total spin

.. math::

  \mathbf{S} = \sum_i \mathbf{S}_i

as well as a series of higher order charges :math:`Q_n`. Existence of these
charges can be derived from the transfer matrix theory. Explicit expressions
for :math:`Q_n` were obtained in [GM94]_. The following script constructs
Hamiltonian of the Heisenberg chain with periodic boundary conditions
(see :func:`heisenberg() <pycommute.models.heisenberg>`)
and checks that :math:`[\hat H, \mathbf{S}] = 0`, :math:`[\hat H, Q_n] = 0` and
:math:`[Q_n, Q_m] = 0` for :math:`m,n = 3,4,5`.

.. literalinclude:: examples/heisenberg_chain.py
  :language: python
  :lines: 11-
  :linenos:

Spectrum of Tavis-Cummings model
--------------------------------

In this example we demonstrate how to use tools from the
:mod:`loperator <pycommute.loperator>` module along with NumPy's eigensolvers to
diagonalize Hamiltonians of simple quantum models.

We will consider a two-atom Jaynes-Cummings (Tavis-Cummings) Hamiltonian
[TC68]_, which models a system of two qubits coherently coupled via a bosonic
degree of freedom (quantum oscillator),

.. math::

  \hat H = \epsilon (\hat S_{z,0} + \hat S_{z,1}) +
           \omega \hat a^\dagger \hat a
           + g_0 (\hat a^\dagger \hat S_{-,0} + \hat a \hat S_{+,0})
           + g_1 (\hat a^\dagger \hat S_{-,1} + \hat a \hat S_{+,1}).

An expression of this form can be conveniently generated by a single call to
:func:`jaynes_cummings() <pycommute.models.jaynes_cummings>`.

Since the occupation number of the bosonic mode can formally grow
to :math:`+\infty`, we have to artificially restrict the dimension of the
bosonic Hilbert space in order to be able to construct a finite matrix
representation of our problem.

.. note::

  Performance of repeated calls to
  :class:`LOperatorR <pycommute.loperator.LOperatorR>` (or
  :class:`LOperatorC <pycommute.loperator.LOperatorC>`) in order to construct
  a matrix representation of a linear operator is limited by Python method
  call overhead. For large-scale problems it is advised to call the utility
  function :func:`make_matrix() <pycommute.loperator.make_matrix>`.

.. literalinclude:: examples/tavis_cummings.py
  :language: python
  :lines: 11-
  :linenos:

Sectors of a multi-orbital interaction Hamiltonian
--------------------------------------------------

When implementing an exact diagonalization algorithm, it is usually advantageous
to take an extra preparatory step and split the Hilbert space of the problem
into subspaces (sectors) characterized by a set of quantum numbers.
In many situations, it is possible to find the sectors even without knowing
the quantities conserved by the Hamiltonian (see, for instance, [SKFP16]_).

In the script shown below we construct an electron-electron interaction
Hamiltonian of an atomic :math:`d`-shell using
:func:`Slater <pycommute.models.slater_int>` parameterization. Then, we employ
the :class:`SpacePartition <pycommute.loperator.SpacePartition>` and
:class:`BasisMapper <pycommute.loperator.BasisMapper>` utility classes (and
optionally the :func:`make_matrix() <pycommute.loperator.make_matrix>` function)
to independently diagonalize the Hamiltonian within each sector.

.. literalinclude:: examples/space_partition.py
  :language: python
  :lines: 11-
  :linenos:

N-fermion sector views
----------------------

This example shows how to partially diagonalize the single band Fermi-Hubbard
model on a large 2D square lattice with periodic boundary conditions.

.. math::

  \hat H = -t\sum_{\langle i,j \rangle, \sigma}
            c^\dagger_{i,\sigma} c_{j,\sigma}
            -\mu \sum_{i, \sigma} n_{i,\sigma}
            + U \sum_i n_{i,\uparrow} n_{i,\downarrow}.

The number of atoms in the considered lattice (cluster) is set to 16, which
makes for an intractably large Hilbert space of dimension :math:`2^{32}`.
Since the Hamiltonian of the Hubbard model preserves total numbers of
spin-up and spin-down electrons, one can diagonalize the Hamiltonian within a
single :math:`N`-fermion sector or within a
:math:`(N_\uparrow, N_\downarrow)`-multisector.

An :math:`N`-fermion
:py:class:`sector <pycommute.loperator.NFermionSectorViewR>` is a subspace of
a full Hilbert space, which is spanned by all basis states with a fixed total
occupation of fermionic degrees of freedom (FDOF). Similarly, a
:py:class:`multisector <pycommute.loperator.NFermionMultiSectorViewR>` is
spanned by all basis states with a fixed occupation :math:`N_1` of a subset of
the FDOF :math:`\{S_1\}`, occupation :math:`N_2` of another subset
:math:`\{S_2\}` and so on. There can be any number of pairs
:math:`(\{S_i\}, N_i)` (sectors contributing to the multisector) as long as
all the subsets :math:`\{S_i\}` are disjoint.

In our example we consider a moderately sized sector with :math:`N = 2`
(:math:`\dim = {32 \choose 2} = 496`)
and a multisector with :math:`N_\uparrow = 1, N_\downarrow = 1`
(:math:`\dim = {16 \choose 1}{16 \choose 1} = 256`).

.. note::

  In general, the N-fermion (multi)sector views and functions do not require
  a purely fermionic system. The definitions of a sector and a
  multisector stand in presence of bosons or spins.

.. literalinclude:: examples/n_fermion_sectors.py
  :language: python
  :lines: 11-
  :linenos:


Advanced: A user-defined algebra
--------------------------------

It is possible to define generators of a new algebra in addition to the
fermionic, bosonic and spin operators to be used in
:ref:`expressions <expression_ref>`. A basic introduction into the topic can be
found on the :ref:`respective documentation page <generator_gamma>` of
*libcommute*. Here, we show how to define the algebra of Dirac
:math:`\gamma`-matrices in a Python script by extending the base class
:py:class:`pycommute.expression.Generator`.

.. literalinclude:: examples/gamma.py
  :language: python
  :lines: 11-
  :linenos:

References
----------

.. [GdMM2013] "Strong Correlations from Hund's Coupling",
  A. Georges, L. de' Medici and J. Mravlje,
  Annu. Rev. Condens. Matter Phys. 2013. 4:137â€“78,
  https://doi.org/10.1146/annurev-conmatphys-020911-125045

.. [GM94] "Quantum Integrals of Motion for the Heisenberg Spin Chain",
  M. P. Grabowski and P. Mathieu,
  Mod. Phys. Lett. A, Vol. 09, No. 24, pp. 2197-2206 (1994),
  https://doi.org/10.1142/S0217732394002057

.. [TC68] "Exact Solution for an N-Molecule-Radiation-Field Hamiltonian",
  M. Tavis and F. W. Cummings
  Phys. Rev. 170, 379 (1968)
  https://doi.org/10.1103/PhysRev.170.379

.. [SKFP16] "TRIQS/CTHYB: A continuous-time quantum Monte Carlo
  hybridisation expansion solver for quantum impurity problems",
  P. Seth, I. Krivenko, M. Ferrero and O. Parcollet,
  Comp. Phys. Comm. 200, March 2016, 274-284,
  http://dx.doi.org/10.1016/j.cpc.2015.10.023 (section 4.2)
